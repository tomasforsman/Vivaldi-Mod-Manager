<Window x:Class="VivaldiModManager.UI.Views.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="clr-namespace:VivaldiModManager.UI.ViewModels"
        xmlns:behaviors="clr-namespace:VivaldiModManager.UI.Behaviors"
        Title="Vivaldi Mod Manager" 
        Height="700" Width="1000"
        MinHeight="500" MinWidth="800"
        WindowStartupLocation="CenterScreen"
        Background="{StaticResource BackgroundBrush}"
        behaviors:DropFileBehavior.Command="{Binding DropFilesCommand}"
        behaviors:DropFileBehavior.AllowedExtensions=".js"
        >

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Menu Bar -->
        <Menu Grid.Row="0" Background="{StaticResource SurfaceBrush}">
            <MenuItem Header="_File">
                <MenuItem Header="_Add Mod..." Command="{Binding AddModCommand}"/>
                <Separator/>
                <MenuItem Header="_Settings..." Command="{Binding ShowSettingsCommand}"/>
                <Separator/>
                <MenuItem Header="E_xit" Command="{Binding ExitCommand}"/>
            </MenuItem>
            <MenuItem Header="_View">
                <MenuItem Header="_Refresh" Command="{Binding RefreshInstallationsCommand}"/>
            </MenuItem>
            <MenuItem Header="_Tools">
                <MenuItem Header="_Inject Mod Loader" Command="{Binding InjectModsCommand}"/>
                <MenuItem Header="_Safe Mode" Command="{Binding EnableSafeModeCommand}"/>
            </MenuItem>
            <MenuItem Header="_Help">
                <MenuItem Header="_About" Command="{Binding ShowAboutCommand}"/>
            </MenuItem>
        </Menu>

        <!-- Main Content -->
        <Grid Grid.Row="1" Margin="16">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="300"/>
                <ColumnDefinition Width="8"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <!-- Left Panel -->
            <Grid Grid.Column="0">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="8"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <!-- Installations Section -->
                <Border Grid.Row="0" Style="{StaticResource ModernCardStyle}" Margin="0,0,0,8">
                    <StackPanel>
                        <TextBlock Text="Vivaldi Installations" Style="{StaticResource SubheadingTextStyle}"/>
                        <ListBox ItemsSource="{Binding Installations}"
                                SelectedItem="{Binding SelectedInstallation}"
                                Style="{StaticResource ModernListBoxStyle}"
                                MaxHeight="150">
                            <ListBox.ItemTemplate>
                                <DataTemplate>
                                    <StackPanel>
                                        <TextBlock Text="{Binding Name}" FontWeight="SemiBold"/>
                                        <TextBlock Text="{Binding Version}" Style="{StaticResource CaptionTextStyle}"/>
                                        <TextBlock Text="{Binding StatusText}" Style="{StaticResource CaptionTextStyle}"/>
                                    </StackPanel>
                                </DataTemplate>
                            </ListBox.ItemTemplate>
                        </ListBox>
                    </StackPanel>
                </Border>

                <!-- Quick Actions -->
                <Border Grid.Row="3" Style="{StaticResource ModernCardStyle}">
                    <StackPanel>
                        <TextBlock Text="Quick Actions" Style="{StaticResource SubheadingTextStyle}"/>
                        <Button Content="🔧 Inject Mod Loader" 
                                Command="{Binding InjectModsCommand}"
                                Style="{StaticResource ModernButtonStyle}"
                                Margin="0,4"/>
                        <Button Content="🛡️ Safe Mode" 
                                Command="{Binding EnableSafeModeCommand}"
                                Style="{StaticResource ModernButtonStyle}"
                                Margin="0,4"/>
                        <Button Content="🔄 Refresh" 
                                Command="{Binding RefreshInstallationsCommand}"
                                Style="{StaticResource ModernButtonStyle}"
                                Margin="0,4"/>
                        <Button Content="⚙️ Settings" 
                                Command="{Binding ShowSettingsCommand}"
                                Style="{StaticResource ModernButtonStyle}"
                                Margin="0,4"/>
                    </StackPanel>
                </Border>
            </Grid>

            <!-- Splitter -->
            <GridSplitter Grid.Column="1" 
                         Width="2" 
                         HorizontalAlignment="Center" 
                         VerticalAlignment="Stretch"
                         Background="{StaticResource BorderBrush}"/>

            <!-- Right Panel - Mod Management -->
            <Grid Grid.Column="2">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="8"/>
                    <RowDefinition Height="200"/>
                </Grid.RowDefinitions>

                <!-- Mod List Header -->
                <Border Grid.Row="0" Style="{StaticResource ModernCardStyle}" Margin="0,0,0,8">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        
                        <TextBlock Grid.Column="0" Text="Mod Management" Style="{StaticResource SubheadingTextStyle}"/>
                        
                        <StackPanel Grid.Column="1" Orientation="Horizontal">
                            <Button Content="Add Mod" 
                                    Command="{Binding AddModCommand}"
                                    Style="{StaticResource ModernButtonStyle}"
                                    Margin="4,0"/>
                            <Button Content="Import" 
                                    Command="{Binding ImportModsCommand}"
                                    Style="{StaticResource ModernButtonStyle}"
                                    Margin="4,0"/>
                            <Button Content="Export" 
                                    Command="{Binding ExportModsCommand}"
                                    Style="{StaticResource ModernButtonStyle}"
                                    Margin="4,0"/>
                            <Button Content="Move Up"
                                    Command="{Binding MoveModUpCommand}"
                                    Style="{StaticResource ModernButtonStyle}"
                                    Margin="4,0"/>
                            <Button Content="Move Down"
                                    Command="{Binding MoveModDownCommand}"
                                    Style="{StaticResource ModernButtonStyle}"
                                    Margin="4,0"/>
                            <Button Content="Remove"
                                    Command="{Binding RemoveModCommand}"
                                    Style="{StaticResource ModernButtonStyle}"
                                    Margin="4,0"/>
                        </StackPanel>
                    </Grid>
                </Border>

                <!-- Mod List -->
                <Border Grid.Row="1" Style="{StaticResource ModernCardStyle}">
                    <ListBox ItemsSource="{Binding Mods}"
                            SelectedItem="{Binding SelectedMod}"
                            Style="{StaticResource ModernListBoxStyle}">
                        <ListBox.InputBindings>
                            <KeyBinding Command="{Binding RemoveModCommand}" Key="Delete"/>
                            <KeyBinding Command="{Binding MoveModUpCommand}" Key="Up" Modifiers="Control"/>
                            <KeyBinding Command="{Binding MoveModDownCommand}" Key="Down" Modifiers="Control"/>
                        </ListBox.InputBindings>
                        <ListBox.ItemTemplate>
                            <DataTemplate>
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    
                                    <CheckBox Grid.Column="0" 
                                             IsChecked="{Binding IsEnabled}"
                                             Style="{StaticResource ModernCheckBoxStyle}"
                                             Margin="0,0,8,0"/>
                                    
                                    <StackPanel Grid.Column="1">
                                        <TextBlock Text="{Binding Name}" FontWeight="SemiBold"/>
                                        <TextBlock Text="{Binding Version}" Style="{StaticResource CaptionTextStyle}"/>
                                        <TextBlock Text="{Binding SizeText}" Style="{StaticResource CaptionTextStyle}"/>
                                        <TextBlock Text="{Binding StatusText}" Style="{StaticResource CaptionTextStyle}"/>
                                    </StackPanel>
                                    
                                    <TextBlock Grid.Column="2" 
                                              Text="{Binding Order, StringFormat='Order: {0}'}"
                                              Style="{StaticResource CaptionTextStyle}"
                                              VerticalAlignment="Center"/>
                                </Grid>
                            </DataTemplate>
                        </ListBox.ItemTemplate>
                    </ListBox>
                </Border>

                <!-- Mod Details -->
                <Border Grid.Row="3" Style="{StaticResource ModernCardStyle}">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>
                        
                        <TextBlock Grid.Row="0" Text="Selected Mod Details" Style="{StaticResource SubheadingTextStyle}"/>
                        
                        <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto">
                            <StackPanel DataContext="{Binding SelectedMod}">
                                <TextBlock Text="{Binding Name, StringFormat='File: {0}'}" Style="{StaticResource BodyTextStyle}"/>
                                <TextBlock Text="{Binding Version, StringFormat='Version: {0}'}" Style="{StaticResource BodyTextStyle}"/>
                                <TextBlock Text="{Binding SizeText, StringFormat='Size: {0}'}" Style="{StaticResource BodyTextStyle}"/>
                                <TextBlock Text="Compatible: ✓ Vivaldi 6.0+" Style="{StaticResource BodyTextStyle}"/>
                                <TextBlock Text="{Binding Notes, StringFormat='Notes: {0}'}" Style="{StaticResource BodyTextStyle}" TextWrapping="Wrap"/>
                            </StackPanel>
                        </ScrollViewer>
                        
                        <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Right">
                            <Button Content="Edit Notes" 
                                    Command="{Binding EditNotesCommand}"
                                    Style="{StaticResource ModernButtonStyle}"
                                    Margin="4,0"/>
                            <Button Content="View Source" 
                                    Command="{Binding ViewSourceCommand}"
                                    Style="{StaticResource ModernButtonStyle}"
                                    Margin="4,0"/>
                        </StackPanel>
                    </Grid>
                </Border>
            </Grid>
        </Grid>

        <!-- Status Bar -->
        <StatusBar Grid.Row="2" Background="{StaticResource SurfaceBrush}">
            <StatusBarItem>
                <TextBlock Text="{Binding StatusText}"/>
            </StatusBarItem>
            <StatusBarItem HorizontalAlignment="Right">
                <StackPanel Orientation="Horizontal">
                    <TextBlock Text="{Binding Mods.Count, StringFormat=\{0\} mods}" Margin="0,0,16,0"/>
                    <TextBlock Text="{Binding IsInjectionActive, StringFormat=Injection: \{0\}, Converter={StaticResource BoolToStatusConverter}}" Margin="0,0,16,0"/>
                    <ProgressBar Width="100" Height="16" IsIndeterminate="{Binding IsBusy}" Visibility="{Binding IsBusy, Converter={StaticResource BoolToVisibilityConverter}}"/>
                </StackPanel>
            </StatusBarItem>
        </StatusBar>
    </Grid>
</Window>
